<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      * { font-family: Arial, sans-serif; box-sizing:border-box; }

      /* ---------- layout ---------- */
      body      { margin:0; display:flex; min-height:100vh; background:linear-gradient(135deg,#0f172a,#111827 40%,#0b1323); color:#EDEDED; }
      #sidebar  { width:280px; background:rgba(0,0,0,.7); padding:24px 20px; overflow-y:auto; backdrop-filter: blur(10px); border-right:1px solid #222; }
      #content  { flex:1; padding:32px; }

      /* ---------- header ---------- */
      #brand    { text-align:center; margin-bottom:32px; }
      /* AS portfolio-style logo */
      .as-logo-wrap{ display:inline-flex; align-items:center; gap:10px; padding:10px 14px; border-radius:12px; background:rgba(255,255,255,.04); border:1px solid #27272a; box-shadow: 0 10px 30px rgba(0,0,0,.25) inset; }
      .as-logo-badge{ width:42px; height:42px; border-radius:10px; display:grid; place-items:center; font-weight:800; color:#0f172a; background:linear-gradient(135deg,#FFE317,#3BFF9D); box-shadow: 0 8px 20px rgba(251,191,36,.25); }
      .as-logo-text{ display:flex; flex-direction:column; text-align:left; line-height:1.1; }
      .as-logo-title{ font-size:18px; font-weight:800; letter-spacing:.5px; }
      .as-logo-sub{ font-size:11px; color:#a1a1aa; }
      /* modal */
      .modal-overlay{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; background:rgba(15,23,42,.7); backdrop-filter: blur(8px); opacity:0; visibility:hidden; transition: all .25s ease; z-index: 50; }
      .modal-overlay.show{ opacity:1; visibility:visible; }
      .modal{ background:#0b1220; border:1px solid #27272a; border-radius:14px; box-shadow: 0 30px 60px rgba(0,0,0,.35); padding:22px 22px; max-width:560px; margin:16px; }
      .modal h3{ margin:0 0 8px; font-size:20px; font-weight:800; }
      .modal p{ margin:8px 0; color:#a1a1aa; line-height:1.5; }
      .modal .btn{ margin-top:14px; padding:10px 14px; border-radius:10px; border:0; font-weight:700; cursor:pointer; color:#0f172a; background:linear-gradient(135deg,#FFE317,#3BFF9D); }

      /* ---------- sidebar ---------- */
      .cat      { margin:24px 0 8px; font-size:20px; color:#B480FF; font-weight:700; }
      .nav-link { display:block; margin:6px 0; padding:8px 10px; cursor:pointer; border-radius:8px;
                  color:#CFCFCF; text-decoration:none; border-left:4px solid transparent; transition: all .2s ease; }
      .nav-link:hover   { color:#FFF; background:rgba(180,128,255,.08); transform: translateX(2px); }
      .nav-link.active  { color:#fff; border-left-color:#B480FF; background:linear-gradient(90deg,rgba(180,128,255,.15),transparent); }

      /* ---------- tables ---------- */
      table     { border-collapse:collapse; width:100%; margin:24px 0; background:rgba(17,24,39,.6); backdrop-filter: blur(6px); border-radius:14px; overflow:hidden; box-shadow: 0 12px 30px rgba(0,0,0,.25); }
      th, td    { border:1px solid #2a2a2e; padding:10px 12px; text-align:center; }
      thead th  { background:#1f2937; position:relative; }
      thead th:after { content:''; position:absolute; inset:0; background:linear-gradient(180deg,rgba(180,128,255,.15),transparent); pointer-events:none; }
      .div-header { background:#9BBB59; color:#FFF; }
      h2        { color:#B480FF; margin:24px 0 12px; display:flex; align-items:center; gap:10px; }
      h2:before { content:''; width:6px; height:22px; border-radius:3px; background:linear-gradient(180deg,#FFE317,#3BFF9D); box-shadow: 0 4px 12px rgba(251,191,36,.25); }
      .title-list{ text-align:left; }

      .error    { color:red; font-weight:bold; padding:24px; }
      .hidden   { display:none; }

      /* dynamics */
      .fade-up{ opacity:0; transform: translateY(18px); animation: fadeUp .45s ease forwards; }
      .fade-up-delayed{ opacity:0; transform: translateY(18px); animation: fadeUp .45s ease .12s forwards; }
      @keyframes fadeUp{ to{ opacity:1; transform: translateY(0);} }
      tbody tr{ transition: background .15s ease, transform .15s ease; }
      tbody tr:hover{ background: rgba(180,128,255,.08); transform: scale(1.005); }
    </style>
  </head>
  <body>
  <? if (false) { ?>
      <p class="error">You have no access.</p>
  <? } else { ?>

    <!-- ============  SIDEBAR  ============ -->
    <nav id="sidebar">
      <!-- brand -->
      <div id="brand" class="fade-up">
        <div class="as-logo-wrap">
          <div class="as-logo-badge">AS</div>
          <div class="as-logo-text">
            <div class="as-logo-title">Aaqil Shiraz</div>
            <div class="as-logo-sub">Salary Scales Viewer</div>
          </div>
        </div>
      </div>

      <?
        /* ---------- helper functions ---------- */
        function categoryOf(div){
          if (div === "HO")                  return "Head Office";
          if (div === "Business Development")return "Business Development";
          if (div === "Operations")          return "Operations";
          if (["Engineering","QA","Product","Design","System Admin","Service Desk",
               "Analytics","Integrations","Infrastructure"].indexOf(div)!==-1) return "Tech";
          if (div === "Risk")                return "Risk";
          return "Other";
        }
        function emojiOf(div){
          switch(div){
            case "Engineering":      return "ðŸ‘¨ðŸ»â€ðŸ’»";
            case "Product":          return "ðŸ”—";
            case "Design":           return "ðŸ‘¨ðŸ»â€ðŸŽ¨";
            case "QA":               return "â‡ï¸";
            case "System Admin":     return "ðŸ–‡ï¸";
            case "Service Desk":     return "â˜Žï¸";
            case "Analytics":        return "ðŸ§™ðŸ»â€â™‚ï¸";
            case "Integrations":     return "ðŸ‘«";
            case "Risk":             return "ðŸ”Ž";
            default:                 return "";
          }
        }
        function splitByLocation(div){
          return ["HO","Business Development","Operations"].indexOf(div)!==-1;
        }

        /* ---------- sort groups so each category appears once ---------- */
        var catOrder = ["Head Office","Business Development","Operations","Tech","Risk","Other"];
        groups.sort(function(a,b){
          var ca = categoryOf(a.division), cb = categoryOf(b.division);
          if (ca !== cb) return catOrder.indexOf(ca) - catOrder.indexOf(cb);
          return a.division.localeCompare(b.division);
        });

        var seenKeys = {};   // keeps unique sidebar items
        var lastCat  = "";

        for (var g=0; g<groups.length; g++){
          var grp = groups[g];

          /* sidebar key logic */
          var navKey   = splitByLocation(grp.division)
                         ? (grp.division + "|" + grp.location)   // e.g. "HO|UAE"
                         : grp.division;                         // e.g. "Engineering"
          if (seenKeys[navKey]) continue;                       // skip duplicates

          /* category header (printed once per contiguous block) */
          var cat = categoryOf(grp.division);
          if (cat !== lastCat){
            if (lastCat !== "") { ?><? } ?>
            <div class="cat"><?= cat ?></div>
            <? lastCat = cat; }

          /* flag & emoji for label */
          var flag = "";
          if (splitByLocation(grp.division)){
            flag = (grp.location==="UAE")?"ðŸ‡¦ðŸ‡ª":(grp.location==="KSA")?"ðŸ‡¸ðŸ‡¦":
                   (grp.location==="Egypt")?"ðŸ‡ªðŸ‡¬":(grp.location==="Remote")?"ðŸŒ":"ðŸ³ï¸";
          }
          var emo  = emojiOf(grp.division);

      ?>
          <a class="nav-link" data-key="<?= navKey ?>">
            <? if (flag){ ?><?= flag ?>&nbsp;<? } ?>
            <? if (emo){ ?><?= emo ?>&nbsp;<? } ?>
            <?= splitByLocation(grp.division)
                 ? (grp.location + " " + grp.division)
                 : grp.division ?>
          </a>
      <?
          seenKeys[navKey] = true;
        } /* end groups loop */
      ?>
    </nav>

    <!-- ============  TABLES  ============ -->
    <main id="content" class="fade-up-delayed">
      <? for (var g=0; g<groups.length; g++){
           var group = groups[g];
           var key   = group.division + "|" + group.location;   // always full key for tables
      ?>
        <section class="tbl hidden" data-key="<?= key ?>">
          <h2><?= group.division ?> â€“ <?= group.location ?> (<?= group.currency ?>)</h2>
          <table>
            <thead>
              <tr>
                <th rowspan="2">Work Level</th>
                <th rowspan="2">Title</th>
                <th class="div-header" colspan="3"><?= group.division.toUpperCase() ?></th>
              </tr>
              <tr>
                <th>MIN <?= group.currency ?> GROSS</th>
                <th>MID <?= group.currency ?> GROSS</th>
                <th>MAX <?= group.currency ?> GROSS</th>
              </tr>
            </thead>
            <tbody>
              <? for (var i=0; i<group.data.length; i++){
                   var row = group.data[i]; ?>
                <tr>
                  <td><?= row.workLevel ?></td>
                  <td class="title-list">
                    <? for (var t=0; t<row.titles.length; t++){ ?>
                      <?= row.titles[t] ?><br>
                    <? } ?>
                  </td>
                  <td><?= isNaN(Number(row.min))? "-" : Number(row.min).toLocaleString() ?></td>
                  <td><?= isNaN(Number(row.mid))? "-" : Number(row.mid).toLocaleString() ?></td>
                  <td><?= isNaN(Number(row.max))? "-" : Number(row.max).toLocaleString() ?></td>
                </tr>
              <? } ?>
            </tbody>
          </table>
        </section>
      <? } ?>

      <? if (groups.length === 0){ ?>
        <p>No jobs available.</p>
      <? } ?>
    </main>

    <!-- Disclaimer Modal -->
    <div class="modal-overlay" id="disclaimerModal">
      <div class="modal">
        <h3>Demo site with mock data</h3>
        <p>This Salary Scales Viewer is part of a personal portfolio. All data is fictional and shown for demonstration only.</p>
        <p>Note: Role-based access control can be applied to this app so each user only sees permitted divisions/locations.</p>
        <button class="btn" onclick="closeDisclaimer()">Got it</button>
      </div>
    </div>

    <!-- ============  JS  ============ -->
    <script>
      const navLinks = document.querySelectorAll('.nav-link');
      const tables   = document.querySelectorAll('.tbl');

      function showDisclaimer(){ document.getElementById('disclaimerModal').classList.add('show'); }
      function closeDisclaimer(){ document.getElementById('disclaimerModal').classList.remove('show'); localStorage.setItem('salaryViewerDisclaimer','1'); }

      /* Show either:
         â€¢ exact match when link key contains a pipe (division|location)
         â€¢ OR every table whose key starts with "<division>|" when link key has no pipe */
      function activate(key){
        navLinks.forEach(l => l.classList.toggle('active', l.dataset.key === key));

        tables.forEach(t => {
          const tblKey = t.dataset.key;
          const show = (key.indexOf('|') !== -1)
                       ? (tblKey === key)
                       : tblKey.startsWith(key + '|');
          t.classList.toggle('hidden', !show);
        });
      }

      if (navLinks.length) activate(navLinks[0].dataset.key);

      // first-visit disclaimer
      if (!localStorage.getItem('salaryViewerDisclaimer')){
        setTimeout(showDisclaimer, 300);
      }

      navLinks.forEach(a => a.addEventListener('click', () => activate(a.dataset.key)));
    </script>

  <? } ?>
  </body>
</html>
